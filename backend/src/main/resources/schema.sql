-- 這是 H2 初始化用的 SQL，請放入與 Oracle 相容的 DDL
-- 注意：H2 的 Oracle 模式支援大部分語法，但請移除 TABLESPACE 等實體儲存設定

CREATE TABLE users (
    id NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR2(50) NOT NULL,
    email VARCHAR2(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 訂單主表
CREATE TABLE TBL_ORDER_MAST (
    ORDER_ID VARCHAR2(10) PRIMARY KEY,
    PROJECT_ID VARCHAR2(16) NOT NULL,
    MEMBER_CARD_ID VARCHAR2(20),
    MEMBER_NAME VARCHAR2(100),
    INSTALL_ZIP VARCHAR2(5),
    INSTALL_ADDR VARCHAR2(200),
    STORE_ID VARCHAR2(5) NOT NULL,
    CHANNEL_ID VARCHAR2(4),
    ORDER_STATUS VARCHAR2(1) DEFAULT '1',
    TOTAL_AMT NUMBER(10) DEFAULT 0,
    HANDLER_ID VARCHAR2(20),
    SPECIALIST_ID VARCHAR2(20),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CREATED_BY VARCHAR2(20),
    UPDATED_BY VARCHAR2(20)
);

-- 訂單明細表
CREATE TABLE TBL_ORDER_DETL (
    LINE_ID VARCHAR2(20) PRIMARY KEY,
    ORDER_ID VARCHAR2(10) NOT NULL,
    SERIAL_NO NUMBER(5),
    SKU_NO VARCHAR2(20) NOT NULL,
    SKU_NAME VARCHAR2(200),
    QUANTITY NUMBER(5) DEFAULT 1,
    POS_AMT NUMBER(10),
    ACT_POS_AMT NUMBER(10),
    TAX_TYPE VARCHAR2(1),
    DELIVERY_FLAG VARCHAR2(1) DEFAULT 'N',
    STOCK_METHOD VARCHAR2(1) DEFAULT 'X',
    DELIVERY_DATE DATE,
    MEMBER_DISC NUMBER(10) DEFAULT 0,
    BONUS_DISC NUMBER(10) DEFAULT 0,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_ORDER_DETL_MAST FOREIGN KEY (ORDER_ID) REFERENCES TBL_ORDER_MAST(ORDER_ID)
);

-- 訂單試算表
CREATE TABLE TBL_ORDER_COMPUTE (
    ID NUMBER(19) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDER_ID VARCHAR2(10) NOT NULL,
    COMPUTE_TYPE VARCHAR2(1) NOT NULL,
    COMPUTE_NAME VARCHAR2(50),
    TOTAL_PRICE NUMBER(10) DEFAULT 0,
    DISCOUNT NUMBER(10) DEFAULT 0,
    ACT_TOTAL_PRICE NUMBER(10) DEFAULT 0,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_ORDER_COMPUTE_MAST FOREIGN KEY (ORDER_ID) REFERENCES TBL_ORDER_MAST(ORDER_ID)
);

-- 商品主檔
CREATE TABLE TBL_SKU_MAST (
    SKU_NO VARCHAR2(20) PRIMARY KEY,
    SKU_NAME VARCHAR2(200),
    CATEGORY VARCHAR2(20),
    TAX_TYPE VARCHAR2(1) DEFAULT '1',
    MARKET_PRICE NUMBER(10),
    REGISTERED_PRICE NUMBER(10),
    POS_PRICE NUMBER(10),
    COST NUMBER(10),
    ALLOW_SALES VARCHAR2(1) DEFAULT 'Y',
    HOLD_ORDER VARCHAR2(1) DEFAULT 'N',
    IS_SYSTEM_SKU VARCHAR2(1) DEFAULT 'N',
    IS_NEGATIVE_SKU VARCHAR2(1) DEFAULT 'N',
    FREE_DELIVERY VARCHAR2(1) DEFAULT 'N',
    FREE_DELIVERY_SHIPPING VARCHAR2(1) DEFAULT 'N',
    ALLOW_DIRECT_SHIPMENT VARCHAR2(1) DEFAULT 'N',
    ALLOW_HOME_DELIVERY VARCHAR2(1) DEFAULT 'Y',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 訂單編號序列
CREATE SEQUENCE SEQ_ORDER_ID START WITH 3000000000 INCREMENT BY 1;

-- 專案編號序列（每日重置）
CREATE SEQUENCE SEQ_PROJECT_ID START WITH 1 INCREMENT BY 1;
