# 25. Risk Assessment - 風險評估與應對

## 目錄

- [1. 風險管理框架](#1-風險管理框架)
- [2. 技術風險](#2-技術風險)
- [3. 業務風險](#3-業務風險)
- [4. 專案風險](#4-專案風險)
- [5. 風險監控](#5-風險監控)

---

## 1. 風險管理框架

### 1.1 風險評估矩陣

```plaintext
影響程度 vs 發生機率

        │ 低 (1)  中 (2)  高 (3)  極高 (4)
────────┼─────────────────────────────────
極高 (4)│   🟡     🟠      🔴      🔴
        │
高 (3)  │   🟢     🟡      🟠      🔴
        │
中 (2)  │   🟢     🟢      🟡      🟠
        │
低 (1)  │   🟢     🟢      🟢      🟡

圖例:
🟢 低風險 (1-4 分): 接受風險
🟡 中風險 (5-8 分): 監控風險
🟠 高風險 (9-12 分): 降低風險
🔴 極高風險 (13-16 分): 避免風險
```

### 1.2 風險應對策略

| 策略 | 說明 | 適用場景 |
|-----|------|---------|
| **避免** (Avoid) | 完全避免風險活動 | 極高風險 (🔴) |
| **降低** (Mitigate) | 降低發生機率或影響 | 高風險 (🟠) |
| **轉移** (Transfer) | 轉移給第三方 | 中高風險 (🟡🟠) |
| **接受** (Accept) | 接受風險並準備應對計畫 | 低風險 (🟢) |

---

## 2. 技術風險

### 2.1 R-T1: 效能未達標

**風險描述**: 新系統效能未達到預期目標 (p95 < 500ms)

| 項目 | 評分 |
|-----|------|
| 發生機率 | 高 (3) |
| 影響程度 | 高 (3) |
| 風險等級 | 🟠 高風險 (9 分) |

**影響**:
- 使用者體驗不佳
- 系統無法上線
- 需要額外優化時間

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **Phase 3 效能測試**
   - JMeter 壓力測試 (100 req/s)
   - 監控 p95/p99 延遲
   - 提前發現瓶頸

2. **Redis 快取優化**
   - 計價結果快取 (TTL 5min, Hit 65%)
   - 會員折扣快取 (TTL 30min, Hit 95%)
   - 預期改善: 1560ms → 420ms (-73%)

3. **並行計算優化**
   - Step 4-5 並行 (運費 + 安裝費)
   - Step 12 並行 (6 種 ComputeType)
   - 預期改善: 1560ms → 1200ms (-23%)

4. **資料庫索引優化**
   - 建立複合索引
   - 避免全表掃描

**應急計畫**:
- 若效能仍未達標, 延後上線 2-4 週進行優化
- 考慮引入更強大的快取方案 (如 Hazelcast)

---

### 2.2 R-T2: 微服務整合失敗

**風險描述**: 5 個微服務之間整合出現問題

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 極高 (4) |
| 風險等級 | 🟠 高風險 (8 分) |

**影響**:
- 訂單無法完成
- 資料不一致
- 系統無法正常運作

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **Saga Pattern 實作**
   - 補償交易 (Compensating Transaction)
   - 確保資料一致性

2. **API Contract Testing**
   - 使用 Pact 進行契約測試
   - 確保 API 介面一致

3. **Mock Server**
   - WireMock 模擬外部服務
   - 獨立測試各服務

4. **整合測試環境**
   - 建立完整的測試環境
   - 端對端測試

**應急計畫**:
- 建立完整的 Rollback Plan
- 準備降級方案 (Fallback to Monolithic)

---

### 2.3 R-T3: 資料遷移失敗

**風險描述**: 從舊系統遷移資料到新系統失敗或資料遺失

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 極高 (4) |
| 風險等級 | 🟠 高風險 (8 分) |

**影響**:
- 訂單資料遺失
- 業務中斷
- 客戶投訴

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **雙寫策略 (Dual Write)**
   ```plaintext
   Phase 1: 雙寫
   應用 → 舊 DB (主)
        → 新 DB (次, 非同步)

   Phase 2: 驗證
   比對新舊資料一致性

   Phase 3: 切換
   應用 → 新 DB (主)
        → 舊 DB (唯讀)

   Phase 4: 下線
   移除舊 DB
   ```

2. **資料驗證**
   - 筆數驗證
   - 金額驗證
   - 關鍵欄位比對

3. **ETL 腳本測試**
   - 在測試環境執行 ETL
   - 驗證資料完整性

4. **備份策略**
   - 遷移前完整備份
   - 保留 30 天

**應急計畫**:
- 若遷移失敗, 從備份還原
- 回滾到舊系統

---

### 2.4 R-T4: 第三方整合問題

**風險描述**: CRM / POS / 支付閘道整合失敗

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 高 (3) |
| 風險等級 | 🟡 中風險 (6 分) |

**影響**:
- 無法查詢會員折扣
- 訂單無法下載到 POS
- 付款失敗

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **Circuit Breaker (熔斷器)**
   ```java
   @CircuitBreaker(name = "crm", fallbackMethod = "fallbackGetMember")
   @Retry(name = "crm", maxAttempts = 3)
   @TimeLimiter(name = "crm", timeout = Duration.ofSeconds(3))
   public MemberInfo getMemberInfo(String memberCardId) {
       return crmClient.getMemberInfo(memberCardId);
   }
   ```

2. **多層降級策略**
   ```plaintext
   Level 1: CRM API
   Level 2: Redis Cache (30min)
   Level 3: Database Cache
   Level 4: Default Value
   ```

3. **Mock Server**
   - 測試環境使用 WireMock
   - 模擬各種回應 (成功/失敗/逾時)

4. **監控告警**
   - CRM API 可用性監控
   - 失敗率告警 (> 5%)

**應急計畫**:
- 使用快取資料
- 手動輸入會員折扣

---

### 2.5 R-T5: 安全漏洞

**風險描述**: 系統存在安全漏洞 (SQL Injection, XSS, etc.)

| 項目 | 評分 |
|-----|------|
| 發生機率 | 低 (1) |
| 影響程度 | 極高 (4) |
| 風險等級 | 🟡 中風險 (4 分) |

**影響**:
- 資料洩露
- 系統被攻擊
- 客戶信任度下降

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **輸入驗證**
   - 所有輸入使用 `@Valid` 驗證
   - 防止 SQL Injection

2. **XSS 防護**
   - Angular 自動 Sanitization
   - CSP (Content Security Policy)

3. **安全掃描**
   - SonarQube 靜態分析
   - OWASP ZAP 動態掃描

4. **簽章驗證**
   - POS 回調簽章驗證
   - 防止偽造請求

**應急計畫**:
- 發現漏洞立即修補
- 必要時暫時下線

---

## 3. 業務風險

### 3.1 R-B1: 需求變更頻繁

**風險描述**: 開發過程中需求頻繁變更

| 項目 | 評分 |
|-----|------|
| 發生機率 | 高 (3) |
| 影響程度 | 中 (2) |
| 風險等級 | 🟡 中風險 (6 分) |

**影響**:
- 時程延誤
- 成本增加
- 團隊士氣低落

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **需求凍結**
   - 每個 Phase 開始前凍結需求
   - 新需求排入下一 Phase

2. **變更管理流程**
   ```plaintext
   需求變更申請
   → 影響評估 (時程/成本)
   → 決策 (接受/拒絕/延後)
   → 執行
   ```

3. **Agile Sprint Planning**
   - 2 週 Sprint
   - Sprint 內不接受新需求

**應急計畫**:
- 重大變更需重新評估時程
- 考慮分階段上線

---

### 3.2 R-B2: 使用者接受度低

**風險描述**: 使用者不接受新系統介面

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 高 (3) |
| 風險等級 | 🟡 中風險 (6 分) |

**影響**:
- 使用者抵制
- 需要重新設計
- 上線延後

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **早期使用者參與**
   - UI/UX 設計階段邀請使用者
   - 收集回饋

2. **原型驗證**
   - Figma 原型展示
   - 使用者測試

3. **UAT (User Acceptance Testing)**
   - Phase 5 進行 UAT
   - 修正使用者回饋

4. **培訓計畫**
   - 上線前使用者培訓
   - 操作手冊

**應急計畫**:
- 保留舊系統 1-3 個月
- 提供切換選項

---

## 4. 專案風險

### 4.1 R-P1: 時程延誤

**風險描述**: 專案無法如期完成

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 高 (3) |
| 風險等級 | 🟡 中風險 (6 分) |

**影響**:
- 上線日期延後
- 成本增加
- 業務損失

**應對策略**: **降低 (Mitigate)**

**預防措施**:
1. **緩衝時間**
   - 每個 Phase 預留 10% 緩衝
   - 總時程 22 週 + 2 週緩衝 = 24 週

2. **里程碑追蹤**
   - 每週進度會議
   - Burndown Chart

3. **關鍵路徑管理**
   - 識別關鍵任務
   - 優先資源配置

4. **風險儲備**
   - 預留 15% 預算應對風險

**應急計畫**:
- 調整範圍 (砍需求)
- 增加人力
- 分階段上線

---

### 4.2 R-P2: 關鍵人員離職

**風險描述**: Tech Lead 或關鍵開發人員離職

| 項目 | 評分 |
|-----|------|
| 發生機率 | 低 (1) |
| 影響程度 | 極高 (4) |
| 風險等級 | 🟡 中風險 (4 分) |

**影響**:
- 知識流失
- 進度嚴重延誤
- 團隊士氣低落

**應對策略**: **降低 (Mitigate) + 轉移 (Transfer)**

**預防措施**:
1. **知識管理**
   - 完整技術文件 (37 份)
   - Code Review 流程
   - Pair Programming

2. **備援人員**
   - 每個模組至少 2 人熟悉
   - 交叉培訓

3. **留才措施**
   - 專案獎金
   - 技術成長機會

**應急計畫**:
- 快速招募替代人員
- 考慮外部顧問支援

---

### 4.3 R-P3: 預算超支

**風險描述**: 專案成本超過預算

| 項目 | 評分 |
|-----|------|
| 發生機率 | 中 (2) |
| 影響程度 | 中 (2) |
| 風險等級 | 🟢 低風險 (4 分) |

**影響**:
- 需要額外預算批准
- 專案中止風險

**應對策略**: **接受 (Accept)**

**預防措施**:
1. **預算管控**
   - 每月成本報告
   - 預算使用率追蹤

2. **風險儲備**
   - 預留 15% 風險預算
   - 總預算 600 萬 + 90 萬 = 690 萬

**應急計畫**:
- 申請追加預算
- 調整範圍降低成本

---

## 5. 風險監控

### 5.1 風險儀表板

```plaintext
Risk Dashboard (Weekly Update)

風險等級分布:
🔴 極高: 0
🟠 高:   3 (R-T1, R-T2, R-T3)
🟡 中:   5 (R-T4, R-T5, R-B1, R-B2, R-P1)
🟢 低:   1 (R-P3)

Top 3 風險:
1. R-T2: 微服務整合失敗 (8 分) - 持續監控
2. R-T3: 資料遷移失敗 (8 分) - 雙寫測試中
3. R-T1: 效能未達標 (9 分) - Phase 3 驗證中
```

### 5.2 風險審查會議

**頻率**: 每兩週

**參與人員**:
- Project Manager
- Tech Lead
- Product Owner

**議程**:
1. 檢視現有風險狀態
2. 識別新風險
3. 更新應對措施
4. 決策行動項目

---

## 總結

### 風險管理核心要點

1. **識別**: 9 個主要風險 (技術 5, 業務 2, 專案 2)
2. **評估**: 3 個高風險, 5 個中風險, 1 個低風險
3. **應對**: 預防 > 應急
4. **監控**: 雙週審查, 持續追蹤

### 最高優先級風險

| 風險 | 等級 | 下一步行動 |
|-----|------|----------|
| R-T1: 效能未達標 | 🟠 9 | Phase 3 效能測試驗證 |
| R-T2: 微服務整合失敗 | 🟠 8 | 實作 Saga Pattern |
| R-T3: 資料遷移失敗 | 🟠 8 | 測試環境 ETL 演練 |

---

**參考文件**:
- `23-Roadmap-Phase5-Testing-Launch.md`: 測試與上線
- `27-Rollback-Plan.md`: 回滾計畫

---

**文件版本**: v1.0
**最後更新**: 2025-10-27
**作者**: AI Architecture Team
